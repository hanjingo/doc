# HTTP协议

[TOC]



`超文本传输协议(HyperText Transfer Protocol, HTTP)` 是一种用于分布式，协作式和超媒体信息系统的应用层协议；

## URI

通过HTTP或HTTPS协议请求的资源由`统一资源标识符(Uniform Resource Identifiers, URI)`来标识；

`统一资源定位符(Uniform Resource Locator, URL)` 是一种特殊类型的URI，用于标识某一处资源的地址；

### 格式

标准格式：

`[协议类型]://[服务器地址]:[端口号]/[资源层级UNIX文件路径][文件名]?[查询]#[片段ID]`

完整格式：

`[协议类型]://[访问资源需要的凭证信息]@[服务器地址]:[端口号]/[资源层级UNIX文件路径][文件名]?[查询]#[片段ID]`

例：

`http://joe:passwd@www.joes-hardware.com:443/tools.html;type=d?item=123#drills`

- `http` 协议类型
- `joe:passwd` 凭证信息，用户名joe，密码passwd
- `www.joes-hardware.com` 服务器地址（主机名）
- `443` 服务器端口号
  - `443` 超文本传输安全协议(HTTPS)的常用端口号
  - `80` 超文本传输协议(HTTP)的常用端口号
  - `8080` 代理服务端口
- `tools.html` 路径
- `;type=d` 参数
- `?item=123` 查询部分（搜索）
- `drills` 文件tools.html中的一个片段

### URL快捷方式

URL有两种方式：

- `绝对` 完整的URL路径
- `相对` 不完整的URL路径，需要通过基础URL解析出来

#### 相对URL

![http_url_parse](res/http_url_parse.png)

*将相对URL转换为绝对URL*

### URI,URL和URN的区别

- URI

  统一资源标识符，用来唯一标识一个资源。

- URL

  统一资源定位器，是一种特殊的URI，可以用来标识一个资源，并且指明了如何locate这个资源。

- URN

  统一资源命名，用来命名资源但不指定如何定位资源。



## HTTP报文

### 请求报文(Request Message)

```http
<method> <request-URL> <version>
<headers>

<entity-body>
```

- 请求行

  - `method(请求方法)` 客户端希望服务器对资源执行的动作

    | 动作    | 协议版本 | 是否包含主体 | 说明                                                         |
    | ------- | -------- | ------------ | ------------------------------------------------------------ |
    | GET     | 1.0      | 否           | 请求指定的页面信息，并返回实体主体                           |
    | HEAD    | 1.0      | 否           | 与GET方法类似，只不过返回的响应中没有具体的内容，用户获取报头 |
    | POST    | 1.0      | 是           | 向指定资源提交数据进行处理请求，数据被包含在请求体中。<br>**注意：POST请求可能会导致新的资源的建立或已有资源的修改。** |
    | PUT     | 1.1      | 是           | 从客户端像服务器发送的数据取代指定的文档的内容。             |
    | DELETE  | 1.1      | 否           | 请求服务器删除指定的资源。                                   |
    | CONNECT | 1.1      |              | HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。     |
    | OPTIONS | 1.1      | 否           | 允许客户端查看服务器的性能。                                 |
    | TRACE   | 1.1      | 否           | 回显服务器收到的请求，主要用于测试或诊断。                   |
    | PATCH   | 1.1      |              | 对PUT方法的补充，用来对已知资源进行局部更新。                |

  - `request-URL(请求URL)` 

    所请求的资源路径URL

  - `version(协议版本)` 

    报文所使用的HTTP版本，其格式为：

    `HTTP/<major>.<minor>`

    - `major` 主版本号（整数）
    - `minor` 次版本号（整数）

- `headers(请求头部)`

  见[首部](#首部)

- `entity-body(请求主体)`

例：

```http
GET /hello.txt HTTP/1.1
User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3
Host: www.example.com
Accept-Language: en, mi
...
```

### 响应报文(Response Message)

```http
<version> <status> <reason-phrase>
<headers>

<entrity-body>
...
```

- 响应行

  - `version(协议版本)`

    报文所使用的HTTP版本，其格式为：

    `HTTP/<major>.<minor>`

    - `major` 主版本号（整数）
    - `minor` 次版本号（整数）

  - `status(状态码)`

    | 状态码 | 说明                                           |
    | ------ | ---------------------------------------------- |
    | 1xx    | 消息提示，请求已被服务器接收，继续处理         |
    | 2xx    | 成功，请求已成功被服务器接收，理解，并接受     |
    | 3xx    | 重定向，需要后续操作才能完成这一请求           |
    | 4xx    | 请求错误，请求含有词法错误或者无法被执行       |
    | 5xx    | 服务器错误，服务器在处理某个正确请求时发生错误 |

    常见的状态码：

    | 状态码 | 状态码英文名称                  | 中文描述                                                     |
    | :----- | :------------------------------ | :----------------------------------------------------------- |
    | 100    | Continue                        | 继续。客户端应继续其请求                                     |
    | 101    | Switching Protocols             | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议 |
    |        |                                 |                                                              |
    | 200    | OK                              | 请求成功。一般用于GET与POST请求                              |
    | 201    | Created                         | 已创建。成功请求并创建了新的资源                             |
    | 202    | Accepted                        | 已接受。已经接受请求，但未处理完成                           |
    | 203    | Non-Authoritative Information   | 非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本 |
    | 204    | No Content                      | 无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档 |
    | 205    | Reset Content                   | 重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域 |
    | 206    | Partial Content                 | 部分内容。服务器成功处理了部分GET请求                        |
    |        |                                 |                                                              |
    | 300    | Multiple Choices                | 多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择 |
    | 301    | Moved Permanently               | 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替 |
    | 302    | Found                           | 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI |
    | 303    | See Other                       | 查看其它地址。与301类似。使用GET和POST请求查看               |
    | 304    | Not Modified                    | 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
    | 305    | Use Proxy                       | 使用代理。所请求的资源必须通过代理访问                       |
    | 306    | Unused                          | 已经被废弃的HTTP状态码                                       |
    | 307    | Temporary Redirect              | 临时重定向。与302类似。使用GET请求重定向                     |
    |        |                                 |                                                              |
    | 400    | Bad Request                     | 客户端请求的语法错误，服务器无法理解                         |
    | 401    | Unauthorized                    | 请求要求用户的身份认证                                       |
    | 402    | Payment Required                | 保留，将来使用                                               |
    | 403    | Forbidden                       | 服务器理解请求客户端的请求，但是拒绝执行此请求               |
    | 404    | Not Found                       | 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面 |
    | 405    | Method Not Allowed              | 客户端请求中的方法被禁止                                     |
    | 406    | Not Acceptable                  | 服务器无法根据客户端请求的内容特性完成请求                   |
    | 407    | Proxy Authentication Required   | 请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权 |
    | 408    | Request Time-out                | 服务器等待客户端发送的请求时间过长，超时                     |
    | 409    | Conflict                        | 服务器完成客户端的 PUT 请求时可能返回此代码，服务器处理请求时发生了冲突 |
    | 410    | Gone                            | 客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置 |
    | 411    | Length Required                 | 服务器无法处理客户端发送的不带Content-Length的请求信息       |
    | 412    | Precondition Failed             | 客户端请求信息的先决条件错误                                 |
    | 413    | Request Entity Too Large        | 由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息 |
    | 414    | Request-URI Too Large           | 请求的URI过长（URI通常为网址），服务器无法处理               |
    | 415    | Unsupported Media Type          | 服务器无法处理请求附带的媒体格式                             |
    | 416    | Requested range not satisfiable | 客户端请求的范围无效                                         |
    | 417    | Expectation Failed              | 服务器无法满足Expect的请求头信息                             |
    |        |                                 |                                                              |
    | 500    | Internal Server Error           | 服务器内部错误，无法完成请求                                 |
    | 501    | Not Implemented                 | 服务器不支持请求的功能，无法完成请求                         |
    | 502    | Bad Gateway                     | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |
    | 503    | Service Unavailable             | 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中 |
    | 504    | Gateway Time-out                | 充当网关或代理的服务器，未及时从远端服务器获取请求           |
    | 505    | HTTP Version not supported      | 服务器不支持请求的HTTP协议的版本，无法完成处理               |

  - `reason-phrase(原因短语)`

    状态码的可读版本（状态码英文名称）

- 响应头

  见[首部](#首部)

- 响应正文

  服务器返回给客户端的文本信息

例：

```http
HTTP/1.1 200 OK
Date: Mon, 27 Jul 2009 12:28:53 GMT
Server: Apache
Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT
ETag: "34aa387-d-1568eb00"
Accept-Ranges: bytes
Content-Length: 51
Vary: Accept-Encoding
Content-Type: text/plain
...
```



## 首部

### 通用首部

| 首部              | 描述                                                         |
| ----------------- | ------------------------------------------------------------ |
| Connection        | 允许客户端和服务器指定与请求/响应连接有关的选项              |
| Date              | 提供日期和时间标志，说明报文是什么时间创建的                 |
| MIME-Version      | 给出了发送端使用的MIME版本                                   |
| Trailer           | 如果报文采用了分块传输编码（chunked transfer encoding）方式，就可以用这个首部列出位于trailer部分的首部集合 |
| Transfer-Encoding | 告知接收端为了保证报文的可靠传输，对报文采用了什么编码方式   |
| Update            | 给出了发送端可能想要“升级”使用的新版本或协议                 |
| Via               | 显示了报文经过的中间节点（代理，网关）                       |

| 通用缓存首部  | 描述                                         |
| ------------- | -------------------------------------------- |
| Cache-Control | 用于随报文传送缓存指示                       |
| Pragma        | 另一种随报文传送指示的方式，但并不专用于缓存 |

### 请求首部

| 首部       | 描述                                         |
| ---------- | -------------------------------------------- |
| Client-IP  | 提供了运行客户端的机器的IP地址               |
| From       | 提供了客户端用户的E-mail地址                 |
| Host       | 给出了接收请求的服务器的主机名和端口号       |
| Referer    | 提供了包含当前请求URI的文档的URL             |
| UA-Color   | 提供了与客户端显示器的显示颜色有关的信息     |
| UA-CPU     | 给出了客户端CPU的类型或制造商                |
| UA-Disp    | 提供了与客户端显示器（屏幕）能力有关的信息   |
| UA-OS      | 给出了运行在客户端机器上的操作系统名称及版本 |
| UA-Pixels  | 提供了客户端显示器的像素信息                 |
| User-Agent | 将发起请求的应用程序名称告知服务器           |

| Accept首部      | 描述                               |
| --------------- | ---------------------------------- |
| Accept          | 告诉服务器能够发送哪些媒体类型     |
| Accept-Charset  | 告诉服务器能够发送哪些字符集       |
| Accept-Encoding | 告诉服务器能够发送哪些编码方式     |
| Accept-Language | 告诉服务器能够发送哪些语言         |
| TE              | 告诉服务器可以使用哪些扩展传输编码 |

| 条件请求首部        | 描述                                                       |
| ------------------- | ---------------------------------------------------------- |
| Expect              | 允许客户端列出某请求所要求的服务器行为                     |
| If-Match            | 如果实体标记与文档当前的实体标记相匹配，就获取这份文档     |
| If-Modified-Since   | 除非在某个指定的日期之后资源被修改过，否则就限制这个请求   |
| If-None-Match       | 如果提供的实体标记与当前文档的实体标记不相符，就获取文档   |
| If-Range            | 允许对文档的某个范围进行条件请求                           |
| If-Unmodified-Since | 除非在某个指定日期之后资源没有被修改过，否则就限制这个请求 |
| Range               | 如果服务器支持范围请求，就请求资源的指定范围               |

| 安全请求首部  | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| Authorization | 包含了客户端提供给服务器，以便对其自身进行认证的数据         |
| Cookie        | 客户端用它向服务器传送一个令牌--它并不是真正的安全首部，但确实隐含了安全功能 |
| Cookie2       | 用来说明请求端支持的cookie版本                               |

| 代理请求首部        | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| Max-Forward         | 在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次数--与TRACE方法一同使用 |
| Proxy-Authorization | 与Authorization首部相同，但这个首部是在与代理进行认证时使用的 |
| Proxy-Connection    | 与Connection首部相同，但这个首部是在与代理建立连接时使用的   |

### 响应首部

| 首部        | 描述                                         |
| ----------- | -------------------------------------------- |
| Age         | （从最初创建开始）响应持续时间               |
| Public      | 服务器为其资源支持的请求方法列表             |
| Retry-After | 如果资源不可用的话，在此日期或时间重试       |
| Server      | 服务器应用程序软件的名称和版本               |
| Title       | 对HTML文档来说，就是HTML文档的源端给出的标题 |
| Warning     | 比原因短语中更详细一些的警告报文             |

| 协商首部      | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| Accept-Ranges | 对此资源来说，服务器可接受的范围类型                         |
| Vary          | 服务器查看的其他首部的列表，可能会使响应发生变化；也就是说，这是一个首部列表，服务器会根据这些首部的内容挑选出最适合的资源版本发送给客户端 |

| 安全响应首部       | 描述                                                         |
| ------------------ | ------------------------------------------------------------ |
| Proxy-Authenticate | 来自代理的对客户端的质询列表                                 |
| Set-Cookie         | 不是真正的安全首部，但隐含有安全功能；可以在客户端设置一个令牌，以便服务器对客户端进行标识 |
| Set-Cookie2        | 与Set-Cookie类似，RFC 2965 Cookie定义；                      |
| WWW-Authenticate   | 来自服务器的对客户端的质询列表                               |

### 实体首部

| 实体首部 | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| Allow    | 列出了可以对此实体执行的请求方法                             |
| Location | 告知客户端实体实际上位于何处，用于将接收端定向到资源的（可能是新的）位置（URL）上去 |

| 内容首部         | 描述                               |
| ---------------- | ---------------------------------- |
| Content-Base     | 解析主体中的相对URL时使用的基础URL |
| Content-Encoding | 对主体执行的任意编码方式           |
| Content-Language | 理解主体时最适宜使用的自然语言     |
| Content-Length   | 主体的长度或尺寸                   |
| Content-Location | 资源实际所处的位置                 |
| Content-MD5      | 主体的MD5校验和                    |
| Content-Range    | 在整个资源中此实体表示的字节范围   |
| Content-Type     | 这个主体的对象类型                 |

| 实体缓存首部  | 描述                                                   |
| ------------- | ------------------------------------------------------ |
| ETag          | 与此实体相关的实体标记                                 |
| Expires       | 实体不再有效，要从原始的源端再次获取此实体的日期和时间 |
| Last-Modified | 这个实体最后一次修改的日期和时间                       |



## 版本

| 版本     | 特性 |
| -------- | ---- |
| HTTP/0.9 |      |
| HTTP/1.0 |      |
| HTTP/1.1 |      |
| HTTP/2   |      |



## 参考

[1] [RFC 2616](https://datatracker.ietf.org/doc/html/rfc2616)

[2] [维基百科-超文本传输协议](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE)

[3] [维基百科-URL](https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6)

[4] [100% 的面试官都会问的HTTP面试题](https://zhuanlan.zhihu.com/p/135947893)

[5] [HTTP简介](https://www.cnblogs.com/ranyonsue/p/5984001.html)

[6] [HTTP教程](https://www.runoob.com/http/http-messages.html)

[7] [美]David Gourley, Brian Totty, Marjorie Sayer, Sailu Reddy, Anshu Aggarwal.HTTP权威指南.3ED

