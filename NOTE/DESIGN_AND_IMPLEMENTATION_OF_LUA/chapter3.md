# 第三章 字符串



## 概述

内化（internalization）：每当创建一份新数据时，都会去检查当前系统中是否已经有一份相同的数据；如果有就直接复用，将引用指向这个已经存在的数据，否则重新创建一份新的数据。

1. 在Lua虚拟机中存在一个全局的数据区，用来存放当前系统中的所有字符串。
2. 同一个字符串数据，在Lua虚拟机中只可能有一份副本，一个字符串一旦创建，将是不可变更的。
3. 变量存放的仅仅是字符串的引用，而不是其实际内容



## 字符串实现

触发`luaS_resize`的情景：

- `checkSizes`

  如果没有开GC强制模式，且此时桶的数量>实际存放的字符串的数量*4，将桶数组减少为原来的一半。

- `luaS_init`

  初始化string表和string缓存时，将桶子的初始数量设置为`MINSTRTABSIZE`

- `internshrstr`

  字符串内化时，桶的数量<=存储的字符串数量且字符串数量<=MAX_INT/2

