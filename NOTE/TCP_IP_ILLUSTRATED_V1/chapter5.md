# 第五章 Internet协议



## 引言

IP是TCP/IP协议族中的核心协议。所有TCP，UDP，ICMP和IGMP数据都通过IP数据报传输，但是不保证IP数据报能成功到达目的地。

![IPv4数据报](res/5-1.png)

- 版本（4位）
  - IPv4: 4
  - IPv6: 6
- IHL（Internet头部长度,，4位）：描述32位字的数量，Internet最多$32*15=480$位，即60字节
- 服务类型字段（ToS，8位）
  - DS字段（服务字段，6位）：
  - ECN（显式拥塞通知，2位）：
- 总长度（16位）：IPv4数据报的总长度（单位：字节），最大$2^{16}=65535$字节
- 标识（16位）：标记数据报ID，自增
- 标志（3位）：
- 分片偏移（13位）：
- 生存期（TTL，8位）：可经过的路由器数量的上限，每过一台路由器就减1，到0就丢弃；一般初始化为64或128或255
- 协议（8位）：
- 头部校验和（16位）：校验数据报头是否完整
- 源IP地址（32位）：
- 目的IP地址（32位）：
- 选项（变长）：

![5-2](res/5-2.png)

- 版本（4位）
  - IPv4: 4
  - IPv6: 6
- 服务类型字段（ToS，8位）
  - DS字段（服务字段，6位）：
  - ECN（显式拥塞通知，2位）：
- 流标签（20位）：
- 负载长度（16位）：
- 下一个头部（8位）：
- 跳数限制（8位）：
- 源IP地址（128位）：
- 目的IP地址（128位）：