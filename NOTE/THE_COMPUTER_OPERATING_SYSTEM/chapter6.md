# 第六章 文件管理

[TOC]



## I/O系统的功能，模型和接口

### I/O系统的基本功能

1. 隐藏物理设备的细节

   I/O系统必须通过对设备加以适当的抽象，以隐藏掉物理设备的实现细节，仅向上层进程提供少量的，抽象的读/写命令，如read，write等。

2. 与设备的无关性

   - 用户不仅可以使用抽象的I/O命令，还可以使用抽象的逻辑设备名来使用设备；
   - 可以有效提高OS的可移植性和易适应性；

3. 提高处理机和I/O设备的利用率

4. 对I/O设备进行控制

   对I/O设备有四种控制方式：

   - 采用轮询的可编程I/O方式；
   - 采用中断的可编程I/O方式；
   - 直接存储器访问方式；
   - I/O通道方式。

5. 确保对设备的正确共享

   系统中的设备分为如下两类：

   - 独占设备
   - 共享设备

6. 错误处理

### I/O系统的层次结构和模型

1. I/O软件的层次结构

   ![6_1](res/6_1.png)

   *I/O系统的层次结构*

   - `用户层I/O软件` 实现与用户交互的接口，用户可直接调用该层所提供的，与I/O操作有关的库函数对设备进行操作；
   - `设备独立性软件` 用于实现用户程序与设备驱动器的统一接口，设备命名，设备的保护以及设备的分配与释放等，同时为设备管理和数据传送提供必要的存储空间；
   - `设备驱动程序` 与硬件直接相关，用于具体实现系统对设备发出的操作指令，驱动I/O设备工作的驱动程序；
   - `中断处理程序` 用于保存被中断进程的CPU环境，转入相应的中断处理程序进行处理，处理完毕再恢复被中断进程的现场后，返回到被中断的进程。

2. I/O系统中各种模块之间的层次视图

   ![6_2](res/6_2.png)

   *I/O系统中各模块之间的层次视图*

   - I/O系统的上，下接口
     - `I/O系统接口`
     - `软件/硬件(RW/HW)接口`
   - I/O系统的分层
     - `中断处理程序`
     - `设备驱动程序`
     - `设备独立性软件`

### I/O系统接口

1. 块设备接口
   - 块设备
   - 隐藏磁盘的二维结构
   - 将抽象命令映射为低层操作
2. 流设备接口
   - 字符设备
   - get和put操作
   - in-control指令
3. 网络通信接口



## I/O设备和设备控制器

### I/O设备

1. I/O设备的类型

   按使用特性分类：

   - 存储设备
   - I/O设备

   按传输速率分类：

   - 低速设备
   - 中速设备
   - 高速设备

2. 设备与控制器之间的接口

   ![6_3](res/6_3.png)

   *设备与控制器间的接口*

   - `数据信号线` 用于在设备和设备控制器之间传送数据信号；
   - `控制信号线` 作为由设备控制器向I/O设备发送控制信号时的通路；
   - `状态信号线` 用于传送指示设备当前状态的信号。

### 设备控制器

1. 设备控制器的基本功能

   - 接收和识别命令
   - 数据交换
   - 标识和报告设备的状态
   - 地址识别
   - 数据缓冲区
   - 差错控制

2. 设备控制器的组成

   ![6_4](res/6_4.png)

   *设备控制器的组成*

   - 设备控制器与处理机接口
     - 数据线
     - 地址线
     - 控制线
   - 设备控制器与设备的接口
   - I/O逻辑

### 内存映像I/O

设备寻址形式：

1. 利用特定的I/O指令

   ![6_5a](res/6_5a.png)

   *采用特定的指令形式*

2. 内存映像I/O

   ![6_5b](res/6_5b.png)
   
   *内存映像I/O形式*
   
### I/O通道

1. I/O通道设备的引入

   TODO