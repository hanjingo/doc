# 第一章 操作系统引论

[TOC]



## 1.1 操作系统的目标和作用

### 1.1.1 操作系统的目标

1. 方便性
1. 有效性
   - 提高系统资源利用率
   - 提高系统的吞吐量
3. 可扩充性
4. 开放性

### 1.1.2 操作系统的作用

1. OS作为用户与计算机硬件系统之间的接口

   OS处于用户与计算机硬件系统之间，用户通过OS来使用计算机系统；在OS帮助下，能够方便，快捷，安全，可靠的操纵计算机硬件和运行程序；

   ![1_1](res/1_1.png)

   *OS作为接口的示意图*

2. OS作为计算机系统资源的管理者

3. OS实现了对计算机资源的抽象

   ![1_2](res/1_2.png)

   *I/O软件隐藏了I/O操作实现的细节*

### 1.1.3 推动操作系统发展的主要动力

1. 不断提高计算机资源的利用率
2. 方便用户
3. 器件的不断更新换代
4. 计算机体系结构的不断发展
4. 不断提出新的应用需求



## 1.2 操作系统的发展过程

### 1.2.1 无操作系统的计算机系统

1. 人工操作方式

   人工操作的缺点：

   - 用户独占全机
   - CPU等待人工操作

2. 脱机输入/输出(Off-Line I/O)方式

   ![1_3](res/1_3.png)

   *脱机I/O示意图*
   
   在主机的直接控制下进行输入/输出方式称为联机输入/输出（On-Line I/O）方式，主要优点如下：
   
   - 减少CPU的空闲时间
   - 提高了I/O速度

### 1.2.2 单道批处理系统

1. 单道批处理系统(Simple Batch Processing System)的处理过程：

   ![1_4](res/1_4.png)
   
   *单道批处理系统的处理流程*
   
2. 单道批处理系统的缺点

   - 系统中的资源得不到充分的利用
   
     ![1_5](res/1_5.png)
   
     *单道程序的运行情况*
   
   - 对内存的浪费

### 1.2.3 多道批处理系统(Multiprogrammed Batch Processing System)

1. 多道程序设计的基本概念

   ![1_6](res/1_6.png)

   *多道程序的运行情况*

2. 多道批处理系统的优缺点

   - 资源利用率高

   - 系统吞吐量大

     能提高系统吞吐量的主要原因为：

     1. CPU和其他资源保持“忙碌”状态
     2. 仅当作业完成时或运行不下去时进行切换时，系统开销小

   - 平均周转时间长

   - 无交互能力

3. 多道批处理系统需要解决的问题

   - 处理机管理问题
   - 内存管理问题
   - I/O设备管理问题
   - 文件管理问题
   - 作业管理问题
   - 用户与系统的接口问题
   
   我们把操作系统定义为：操作系统是一组控制和管理计算机硬件和软件资源，合理地对各类作业进行调度，以及方便用户使用的程序的集合。

### 1.2.4 分时系统(Time Sharing System)

1. 分时系统的产生

   分时操作系统（CTSS，Compatible Time Sharing System）与多道批处理系统之间有截然不同的性能差别，他能很好地将一台计算机提供给多个用户同时使用，提高计算机的利用率。它被经常应用于查询系统中，满足许多查询用户的需要。用户的需求具体表现在以下几个方面：

   - 人-机交互
   - 共享主机

2. 分时系统实现中的关键问题

   - 及时接收
   - 及时处理

3. 分时系统的特征

   - 多路性；该特性是指系统允许将多台终端同时连接到一台主机上，并按分时原则为每个用户服务。
   - 独立性；该特性是指系统提供了这样的拥机环境，即每个用户在各自的终端上进行操作，彼此之间互不干扰。
   - 及时性：及时性是指用户的请求能在很短时间内获得响应。
   - 交互性：交互性是指用户可通过终端与系统进行广泛的人机对话。

### 1.2.5  实时系统(Real Time System)

1. 实时系统的类型
   - 工业（武器）控制系统；
   - 信息查询系统；
   - 多媒体系统；
   - 嵌入式系统。
2. 实时任务的类型
   - 周期性实时任务和非周期性实时的任务；
   - 硬实时任务(Hard Real-time Task, HRT)和软实时任务(Soft Real-time Task, SRT)。
3. 实时系统与分时系统特征的比较
   - 多路性
   - 独立性
   - 及时性
   - 交互性
   - 可靠性

### 1.2.6 微机操作系统的发展

1. 单用户单任务操作系统
   - CP/M
   - MS-DOS
   - ...
2. 单用户多任务操作系统
   - Windows 95
   - ...
3. 多用户多任务操作系统
   - Solaris OS
   - Linux OS
   - ...



## 1.3 操作系统的基本特性

### 1.3.1 并发(Concurrence)

1. 并行与并发

   并行性是指两个或多个事件在同一时刻发生；

   并发性是指两个或多个事件在同一时间间隔内发生。

2. 引入进程

   所谓进程，是指在系统中能独立运行并作为资源分配的基本单位，它是由一组机器指令，数据和堆栈等组成的，是一个能独立运行的活动实体。多个进程之间可以并发执行和交换信息。

### 1.3.2 共享(Sharing)

共享（Sharing），是指系统中的资源可供内存中多个并发执行的进程（线程）共同使用，相应地，把这种资源共同使用称为资源共享，或称为资源复用。

实现资源共享的主要方式：

1. 互斥共享方式
2. 同时访问方式

并发和共享是操作系统的两个最基本的特征，它们又是互为存在的条件。一方面，资源共享是以程序（进程）的并发执行为条件的，若系统不允许程序并发执行，自然不存在资源共享问题；另一方面，若系统不能对资源共享实施有效管理，协调好诸进程对共享资源的访问，也必然影响到程序并发执行的程度，甚至根本无法执行。

### 1.3.3 虚拟(Virtual)

1. 时分复用技术
   - 虚拟处理机技术
   - 虚拟设备技术
2. 空分复用技术
   - 虚拟磁盘技术
   - 虚拟存储器技术

如果虚拟的实现是通过时分复用的方法来实现的，即对某一物理设备进行分时使用，设N是某物理设备所对应的虚拟的逻辑设备数，则每台虚拟设备的平均速度必然等于或低于物理设备速度的1/N。类似的，如果是利用空分复用方法来实现虚拟，此时一台虚拟设备平局占用的空间必然也等于或低于物理设备所拥有空间的1/N。

### 1.3.4 异步(Asynchronism)

在多道程序环境下，系统允许多个进程并发执行；异步运行方式是操作系统的一个重要特征。



## 1.4 操作系统的主要功能

### 1.4.1 处理机管理功能

1. 进程控制

2. 进程同步
   - 进程互斥方式：指诸进程（线程）在对临界资源进行访问时，应采用互斥方式；
   - 进程同步方式：指在相互合作去完成共同任务的诸进程（线程）间，由同步机构对他们的执行次序加以协调；
   
3. 进程通信

   当相互合作的进程处于同一计算基系统时，通常在它们之间采用直接通信方式，即由源进程利用发送命令直接将消息（message）挂到目标进程的消息队列上，以后由目标进程利用接受命令从其消息队列中取出消息。

4. 调度
   - 作业调度。作业调度的基本任务是从后备队列中按照一定的算法选择出若干个作业，为它们分配运行所需的资源，在将这些作业掉入内存后，分别为它们建立进程，使他们都成为可能获得处理机的就绪进程，并将它们插入就绪队列中。
   - 进程调度。进程调度的任务是从进程的就绪队列中按照一定的算法选出一个进程，将处理机分配给它，并为它设置运行现场，使其投入执行。

### 1.4.2 存储器管理功能

1. 内存分配

   内存分配的主要任务是：

   - 为每道程序分配内存空间；
   - 提高存储器的利用率，尽量减少不可用的内存空间（碎片）；
   - 允许正在运行的程序申请附加的内存空间，以适应程序和数据动态增长的需要。

   OS在实现内存分配时，可采取以下方式：

   - 静态分配方式。每个作业的内存空间是在作业装入时确定的，在作业装入后的整个运行期间不允许该作业再申请新的内存空间，也不允许作业再内存中“移动”。
   - 动态分配方式。每个作业所要求的基本内存空间虽然也是在装入时确定的，但允许作业在运行过程中继续申请新的附加内存空间，以适应程序和数据的动态增长，也允许作业在内存中“移动”。
   
2. 内存保护

   - 确保每道用户程序都仅在自己的内存空间内运行，彼此互不干扰。
   - 绝不允许用户程序访问操作系统的程序和数据；也不允许用户程序转移到非共享的其它用户程序中去执行。

3. 地址映射

   每道程序的各程序段的地址空间内的逻辑地址与其在内存空间中的物理地址并不相一致。为保证程序能正确运行，存储器管理必须提供地址映射功能，即能够将地址空间中的逻辑地址转换为内存空间中与之对应的物理地址。

4. 内存扩充

   系统必须具有内存扩充机制，用于实现下述功能：

   - 请求调入功能，系统允许在仅装入部分用户程序和数据的情况下，便能启动该程序运行。
   - 置换功能，若发现在内存中已无足够的空间来装入需要调入的程序和数据时，系统应能将内存中的一部分暂时不用的程序和数据调至硬盘上，以腾出内存空间，然后在将所需调入的部分装入内存。

### 1.4.3 设备管理功能

设备管理的主要任务：

- 完成用户进程提出的I/O请求；为用户进程分配其所需的I/O设备：提高CPU和I/O设备的利用率。
- 提高CPU和I/O设备的利用率，提高I/O速度，方便用户使用I/O设备。

1. 缓冲管理：最常见的缓冲区机制有单缓冲机制，能实现双向同时传送数据的双缓冲机制；

2. 设备分配：根据用户进程的I/O请求，系统现有资源情况以及按照某种设备分配策略，为之分配其所需的设备；

3. 设备处理：又称为设备驱动程序，用于实现CPU和设备控制器之间的通信。

### 1.4.4 文件管理功能

1. 文件存储空间的管理

   为每个文件分配必要的外存空间，提高外存的利用率，进而提高文件系统的存，取速度。

2. 目录管理

   为每个文件建立一个目录项，包括文件名，文件属性，文件在磁盘上的物理位置等，并对众多的目录项加以有效的组织，以实现方便的按名存取。

3. 文件的读/写管理和保护

   1. 文件的读/写管理

      根据用户的请求，从外存中读取数据，或将数据写入外存。

   2. 文件保护

      为了防止系统中的文件被非法窃取和破坏，在文件系统中必须提供有效的存取控制功能，以实现下述目标：
   
      - 防止未经核准的用户存取文件；
      - 防止冒名顶替存取文件；
      - 防止以不正确的方式使用文件。

### 1.4.5 操作系统与用户之间的接口

1. 用户接口
   - 联机用户接口
   - 脱机用户接口
   - 图形用户接口
   
2. 程序接口

   为用户程序在执行中访问系统资源而设置的，由一组系统调用组成，是用户程序取得操作系统服务的唯一途径。

### 1.4.6 现代操作系统的新功能

1. 系统安全
   - 认证技术
   - 密码技术
   - 访问控制技术
   - 反病毒技术
2. 网络的功能和服务
   - 网络通信
   - 资源管理
   - 应用互操作
3. 支持多媒体
   - 接纳控制功能
   - 实时调度
   - 多媒体文件的存储



## 1.5 OS结构设计

### 1.5.1 传统操作系统结构

1. 无结构操作系统

   OS是为数众多的一组过程的集合，每个过程可以任意地相互调用其它过程，致使操作系统内部既复杂又混乱。

2. 模块化结构OS

   - 模块化程序设计技术的基本概念

     ![1_7](res/1_7.png)

     *模块化结构的操作系统*

   - 模块的独立性

     1. 内聚性，指模块内部各部分间联系的紧密程度。内聚性越高，模块的独立性越强。

     2. 耦合度，指模块间相互联系和相互影响的程度。显然，耦合度越低，模块的独立性越好。

   - 模块接口法的优点
   
     - 提高OS设计的正确性，可理解性和可维护性；
     - 增强OS的适应性；
     - 加速OS的开发过程；
     
   - 模块接口法地缺点
   
     - 在OS设计时，对各模块间地接口规定很难满足再模块设计完成后对接口的实际需求。
     - 在OS设计阶段，各模块的设计齐头并进，无法寻找一个可靠的决定顺序，造成各种决定的“无序性”。
   
2. 分层式结构OS

   - 分层式结构的基本概念
   
     自底向上的分层设计的基本原则是：每一步设计都建立在可靠的基础上。
   
   - 分层结构的优缺点：
   
     1. 易保证系统的正确性
     2. 易扩充和易维护性

### 1.5.2 客户/服务器模式(Client/Server Model)简介

1. 客户/服务器模式的由来，组成和类型
   - 客户机
   - 服务器
   - 网络系统
2. 客户/服务器之间的交互
   1. 客户发送请求信息
   2. 服务器接收消息
   3. 服务器回送消息
   4. 客户机接收消息
3. 客户/服务器模式的优点
   1. 数据的分布处理和存储
   2. 便于集中管理
   3. 灵活性和可扩充性
   4. 易于改编应用软件

### 1.5.3 面向对象的程序设计(Object-Orientated Programming)技术简介

1. 面向对象技术的基本概念

   - 对象

     ![1_8](res/1_8.png)

     *一个对象的示意图*

   - 对象类

     在实践中，有许多对象可能标识的是同一类事物，每个对象具有自己的变量集合，而它们所具有的方法是相同的。

   - 继承

     继承是父类和子类之间共享变量和方法的机制，该机制规定子类自动继承父类中定义的变量和方法，并允许子类再增加新的内容。

     ![1_10](res/1_10.png)

2. 面向对象技术的优点

   - 通过“重用”提高产品质量和生产率
   - 使系统具有更好的易修改性和易扩展性
   - 更易于保证系统的“正确性”和“可靠性”

### 1.5.4 微内核OS结构

1. 微内核操作系统的基本概念

   - 足够小的内核

     微内核通常用于：

     1. 实现与硬件紧密相关的处理
     2. 实现一些较基本的功能
     3. 负责客户和服务器之间的通信

   - 基于客户/服务器模式

     ![1_11](res/1_11.png)

     *在单机环境下的客户/服务器模式*

   - 应用“机制与策略分离”原理

     机制：指实现某一功能的具体执行机构

     策略：在机制的基础上，借助于某些参数和算法来实现该功能的优化，或达到不同的功能目标

     通常机制处于一个系统的基层，策略处于系统的高层；

   - 采用面向对象技术

2. 微内核的基本功能

   - 进程（线程）管理
   - 低级存储器管理
   - 中断和陷入处理

3. 微内核操作系统的优点

   - 提高了系统的可扩展性
   - 增强了系统的可靠性
   - 可移植性
   - 提供了对分布式系统的支持
   - 融入了面向对象技术

4. 微内核操作系统存在的问题

   在完成一次客户对OS提出的服务请求时，需要利用消息实现多次交互和进行用户/内核模式及上下文的多次切换。

   由于客户和服务器及服务器和服务器之间的通信，都需要通过微内核，致使同样的服务请求至少需要进行4次上下文切换：

   - 第一次发生在客户发送请求消息给内核，以请求取得某服务器特定的服务时；
   - 第二次是发生在由内核把客户的请求消息发往服务器时；
   - 第三次是当服务器完成客户请求后，把响应消息发送到内核时；
   - 第四次是在内核将响应消息发送给客户时；

   ![1_12](res/1_12.png)

   *在传统OS和微内核OS中的上下文切换*

