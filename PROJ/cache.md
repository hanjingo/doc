[TOC]

# 缓存系统



## 缓存方案

### 方案一

1. 先删除缓存
2. 再更新数据库，避免脏数据

### 方案二

1. 先更新数据库
2. 再删除缓存

### 方案三

1. 先淘汰缓存
2. 再写数据库
3. 休眠一段时间，再次淘汰缓存



## 缓存穿透

缓存和数据库中都没有的数据，用户还是源源不断的发起请求，导致每次请求都会到数据库，从而压垮数据库

### 解决方案

1. 业务层校验

   对用户发过来的请求进行检查，有问题直接拦截

2. 对于查找不到的数据，在redis中将其值设置为NULL，并设置较短的过期时间

3. 布隆过滤器

   利用布隆过滤器的特性，判断数据存不存在，存在才去查找



## 缓存击穿

redis中一个热点key在失效的同时，大量的请求过来，这些请求全部到达数据库，压垮数据库

### 解决方案

1. 设置热点数据永不过期

   对于频繁读取的数据设置其永不过期

2. 定时更新过期时间

   在过期时间到来之前，去给它重新设置（续命）

3. 互斥锁

   利用一个redis中的数据值来作为锁标记，锁住时设置为1或true，释放锁时设置为0或false（记得设置过期，放置锁死）；要想修改数据库，得先拿到这个锁标记。

   

## 缓存雪崩

redis中混存的数据大面积失效或者redis宕机，导致大量请求直接到数据库，压垮数据库。

### 解决方案

1. 数据过期时间不要太密集，不要全都排到一起失效

2. 数据预热

   对于即将来临的大量请求，提前缓存到redis中

3. 保证redis高可用

   做集群