[TOC]

# 网络问题



## 大小端问题

### 问题描述

这是个历史遗留问题，一般手机，pc用的小端 比如 `(uint32)3019 = [203 11 0 0]`；服务器一般用的大端 比如`(uint32)3019 = [0 0 11 203]`，java默认使用大端类型；如果通讯双方的大小端不一致，会导致解码时数据错乱；

### 解决方法

- 方法1

  前后端传数据时，在数据头里面做个标记是大端还是小端，收到消息后做一下转换;

- 方法2(推荐)

  前后端统一使用大端，收到数据后不管大小端都转成大端;



## Nagle算法的坑

TODO



## Tcp timewait问题

### 问题描述

为了防止出现“主动断开连接方发送的最后一个ACK包异常，导致被动关闭防会重发FIN请求，影响该四元组上的下一个连接的正确性”的情况，TCP通过主动关闭方等待`2*MSL`来避免这个问题；但是，引来了另一个问题，如果主动发起方频繁建立/断开连接，会导致系统之存在大量的timewait连接，从而导致没法建立新的连接；

### 解决办法

- 方法一

  设置以下两个内核参数：

  - `net.ipv4.tcp_tw_recycle``

    - `1` 启动time wait连接的快速回收；

  - `net.ipv4.tcp_tw_reuse` 
    
    - `1` 让time wait四元组可以快速用于新连接；

