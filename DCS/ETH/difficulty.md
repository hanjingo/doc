# 以太坊挖矿难度



## 难度算法

跟比特币不同，在以太坊系统中每个区块都可能进行难度调整，且在以太坊不同的发展阶段，难度的调整算法也不相同。

难度调整算法:

#### 简单版本：

$D(H) = b + h$

- $b$：基础部分
- $h$：难度部分

#### 复杂版本：

$D(H) \equiv \begin{cases} D_0 & H_i = 0 \\ max(P(H)_{H_d}+x \times s_2)+e & otherwise \end{cases}$

- `D(H)`：本区块的难度

- $P(H)_{H_d}+x \times s_2$：基础难度

    - $P(H)_{H_d}$：父区块难度
    - $x \times s_2$：自适应调节出块难度

- $e$：难度炸弹，主要用来调节难度；每十万个扩大一倍，是2的指数函数，到了后期增长非常快

    $e \equiv \lfloor 2 \lfloor max(H_i - 3000000, 0) \div 100000 \rfloor - 2\rfloor$

    - $max(H_i - 3000000, 0)$：fake block number，由真正的block number减少到三百万得到;这样做的原因是低估了PoS协议的开发难度，属于历史遗留问题

- $D0$：最小值，即下限；131072

- $x$：父区块的难度除以2048后向下取整

    $x \equiv \lfloor \frac{P(H)_{H_d}}{2048} \rfloor$

- $s_2$：当父区块中包含了叔父uncle区块时，y为2，否则为1。

    $s_2=max(y-\lfloor \frac{H_s - P(H)_{H_s}}{9} \rfloor, -99)$

    - $H_s$：本区块的时间戳，单位秒
    - $P(H)_{H_s}$：父区块的时间戳，单位秒
    - $-99$：难度降低的上界，设置为-99主要是为了应对黑客攻击或其他异常情况

**真正决定难度的地方在于：$x \times s_2$（自适应调节出块难度）和$e$（难度炸弹），其他部分都是相对固定的值。**



## 链接

- [以太坊当前难度查询](https://www.etherchain.org/)

