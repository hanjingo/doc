# Solidityè¯­è¨€

[TOC]



## åŸºç¡€è¯­æ³•

### ç¼–è¯‘æŒ‡ç¤º

`pragma`å…³é”®å­—ç”¨äºå¯ç”¨æŸäº›ç¼–è¯‘å™¨åŠŸèƒ½æˆ–æ£€æŸ¥ã€‚

#### ç‰ˆæœ¬æ§åˆ¶

Solidityç‰ˆæœ¬å·æ ¼å¼ä¸ºï¼š`ä¸»ç‰ˆæœ¬å·.å‰¯ç‰ˆæœ¬å·.ä¿®å¤ç‰ˆæœ¬å·`ã€‚

ä¾‹ï¼ŒæŒ‡å®šåˆçº¦ç‰ˆæœ¬å·èŒƒå›´ï¼š

```solidity
pragma solidity >=0.4.16 <0.9.0;
```

ä¾‹ï¼Œç¦ç”¨`0.5.2`ä¹‹å‰çš„ç‰ˆæœ¬ï¼š

```sh
pragma solidity ^0.5.2
```

#### ABIç¼–ç å™¨

ç›®å‰æœ‰`V1`å’Œ`V2`ä¸¤æ¬¾ç¼–/è§£ç å™¨ï¼Œ`V2`ç¼–ç å™¨èƒ½å¤Ÿç¼–ç å’Œè§£ç ä»»æ„åµŒå¥—çš„æ•°ç»„å’Œç»“æ„ã€‚

ä¾‹ï¼Œä½¿ç”¨`V1`ç¼–ç å™¨ï¼š

```solidity
pragma abicoder v1;
```

ä¾‹ï¼Œä½¿ç”¨`V2`ç¼–ç å™¨ï¼š

```solidity
pragma abicoder v2;
```

#### SMTChecker

åœ¨æ„å»º Solidity ç¼–è¯‘å™¨æ—¶å¿…é¡»å¯ç”¨æ­¤ç»„ä»¶ï¼Œå› æ­¤å®ƒå¹¶éåœ¨æ‰€æœ‰ Solidity äºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½å¯ç”¨ã€‚

ä¾‹ï¼Œå¯ç”¨SMTCheckerï¼š

```solidity
pragma experimental SMTChecker;
```

### å¯¼å…¥

ç¼–è¯‘å™¨ç»´æŠ¤ä¸€ä¸ªå†…éƒ¨æ•°æ®åº“ï¼ˆ*è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ*æˆ–ç®€ç§°*VFS*ï¼‰ï¼Œå…¶ä¸­ä¸ºæ¯ä¸ªæºå•å…ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„*æºå•å…ƒåç§°*ï¼Œè¯¥åç§°æ˜¯ä¸€ä¸ªä¸é€æ˜ä¸”éç»“æ„åŒ–çš„æ ‡è¯†ç¬¦ã€‚

å¯¼å…¥æ–¹å¼ï¼š

- å…¨å±€å¯¼å…¥ï¼›
- é‡å‘½åå¯¼å…¥ã€‚

ä¾‹ï¼Œå…¨å±€å¯¼å…¥ï¼š

```solidity
import * as symbol from "filename";
import "filename" // åŒä¸Š
import "filename" as symbol; // åŒä¸Š
```

ä¾‹ï¼Œé‡å‘½åå¯¼å…¥ï¼š

```solidity
import {symbol1 as alias1, symbol2} from "filename";
```

### åŸºæœ¬ç±»å‹

| ç±»å‹                                         | æ”¯æŒçš„æ“ä½œ                                                   | å–å€¼èŒƒå›´                           | è¯´æ˜                             |
| -------------------------------------------- | ------------------------------------------------------------ | ---------------------------------- | -------------------------------- |
| bool                                         | `!, &&, ||, ==, ==, !=`                                      | [false, true]                      | å¸ƒå°”å€¼                           |
| uint<br>int                                  | `<=, <, ==, !=, >=, >`<br>`&, |, ^, ~`<br>`<<, >>`<br>`+, -, *, /, % **(å¹‚)` | [uint8, uint256]<br>[int8, int256] | æ— ç¬¦å·æ•´æ•°<br>æœ‰ç¬¦å·æ•´æ•°         |
| unfixed<br>fixed                             | `<=, <, ==, !=, >=, >`<br>`+, -, *, /, %(æ¨¡)`                | []                                 | æ— ç¬¦å·å®šç‚¹æ•°<br>æœ‰ç¬¦å·å®šç‚¹æ•°     |
| address                                      | `<=, <, ==, !=, >=, >`                                       | [0, 20]byte                        | åœ°å€                             |
| address payable                              | `<=, <, ==, !=, >=, >`                                       | [0, 20]byte                        | å¸¦é™„åŠ æˆå‘˜(transfer, send)çš„åœ°å€ |
| bytes1<br>bytes2<br>bytes3<br>...<br>bytes32 | `<=, <, ==, !=, >=, >`<br>`&, |, ^, ~`<br>`<<, >>`<br>`[i](ç´¢å¼•è®¿é—®)` | [1, n]                             | å­—èŠ‚æ•°ç»„                         |
| string                                       | `\<newline>`(è½¬ä¹‰æ¢è¡Œç¬¦)<br>`\\`(åæ–œæ )<br>`\'`(å•å¼•å·)<br>`\"`(åŒå¼•å·)<br>`\n`(æ–°é˜Ÿ)<br>`\r`(å›è½¦)<br>`\t`(æ ‡ç­¾)<br>`\xNN`(åå…­è¿›åˆ¶è½¬ä¹‰)<br>`\uNNNN`(unicodeè½¬ä¹‰) |                                    | å­—ç¬¦ä¸²                           |
| hex""                                        |                                                              |                                    | åå…­è¿›åˆ¶å­—é¢å€¼                   |

ä¾‹ï¼š

```solidity
address addr1 = address(this);
address payable addr2 = payable(0x123);

string memory str1 = unicode"hello ğŸ˜Š";

hex"001" hex"002" hex'003'
```

### æšä¸¾

æšä¸¾å¯ç”¨äºåˆ›å»ºå…·æœ‰ä¸€ç»„æœ‰é™â€œå¸¸é‡å€¼â€çš„è‡ªå®šä¹‰ç±»å‹ã€‚

ä¾‹ï¼Œå®šä¹‰æšä¸¾ï¼š

```solidity
enum e { One, Two, Three } // å®šä¹‰æšä¸¾
e e1 = e.One; // ä½¿ç”¨æšä¸¾
```

### ç”¨æˆ·é‡å®šä¹‰ç±»å‹

ç”¨æˆ·å®šä¹‰çš„å€¼ç±»å‹å…è®¸åœ¨åŸºæœ¬å€¼ç±»å‹ä¸Šåˆ›å»ºé›¶æˆæœ¬æŠ½è±¡ï¼Œç±»ä¼¼äºåˆ«åã€‚

ä¾‹ï¼š

```solidity
type mytype is uint128;
```

### æ•°æ®åœ°å€

æ¯ä¸ªå¼•ç”¨ç±»å‹æ•°æ®ä½ç½®ä¿®é¥°ï¼š

- `storage` å¯¹æœ¬åœ°å­˜å‚¨å˜é‡çš„èµ‹å€¼åªåˆ†é…ä¸€ä¸ªå¼•ç”¨ï¼›
- `memory` å¯¹ä¸€ä¸ªå†…å­˜å˜é‡çš„æ›´æ”¹åœ¨å¼•ç”¨ç›¸åŒæ•°æ®çš„æ‰€æœ‰å…¶ä»–å†…å­˜å˜é‡ä¸­ä¹Ÿå¯è§ï¼›
- `calldata` ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œå§‹ç»ˆå¤åˆ¶ã€‚

ä¾‹ï¼š

```solidity
function fn(uint[] memory arr1) public {
	uint[] storage arr2 = arr1;
	uint[] calldata arr3 = arr1;
}
```

### æ•°ç»„

æ•°ç»„å¯ä»¥å…·æœ‰ç¼–è¯‘æ—¶å›ºå®šå¤§å°`T[k]`ï¼Œä¹Ÿå¯ä»¥å…·æœ‰åŠ¨æ€å¤§å°`T[]`ã€‚

### åˆ‡ç‰‡

TODO

### å‡½æ•°

åˆ†ç±»ï¼š

- å†…éƒ¨å‡½æ•°ï¼šåªèƒ½åœ¨åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œæ— æ³•åœ¨åˆçº¦ä¸Šä¸‹æ–‡ä¹‹å¤–æ‰§è¡Œï¼›
- å¤–éƒ¨å‡½æ•°ï¼šç”±åœ°å€å’Œå‡½æ•°ç­¾åç»„æˆï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨å‡½æ•°è°ƒç”¨ä¼ é€’å’Œè¿”å›ã€‚

å®šä¹‰ï¼š

å‡½æ•°æ˜¯ä»£ç çš„å¯æ‰§è¡Œå•å…ƒï¼Œå‡½æ•°å¯ä»¥åœ¨åˆçº¦å†…å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨åˆçº¦å¤–å®šä¹‰ã€‚

å‡½æ•°æ ¼å¼ï¼š`function(<parameter types>){internal|external}[pure|view|payable][returns(<resturn types>)]`

- `parameter types` å‚æ•°

- `internal|external`å†…éƒ¨/å¤–éƒ¨å‡½æ•°æ ‡è¯†

- `pure|view|payable` çŠ¶æ€å¯å˜æ€§

  | çŠ¶æ€å¯å˜æ€§ | å¯è½¬æ¢æˆçš„å‡½æ•°          | è¯´æ˜   |
  | ---------- | ----------------------- | ------ |
  | pure       | `view`<br>`non-payable` |        |
  | view       | `non-payable`           |        |
  | payable    | `non-payable`           | å¯æ”¶å¸ |

ä¾‹ï¼Œå®šä¹‰å‡½æ•°ï¼š

```solidity
contract c {
	function fn1() internal payable returns(bytes4) {...}
}
c c1;
c1.fn1();

function fn2(uint x) public pure returns(uint) {...}
```

### äº‹ä»¶

äº‹ä»¶æ˜¯ä¸ EVM æ—¥å¿—è®°å½•å·¥å…·çš„ä¾¿åˆ©æ¥å£ã€‚

ä¾‹ï¼Œä½¿ç”¨äº‹ä»¶ï¼š

```solidity
contract c {
	event fn1(...); // å®šä¹‰äº‹ä»¶
	function fn2() public payable {
		emit fn1(...); // è§¦å‘äº‹ä»¶
	}
}
```

### é”™è¯¯

é”™è¯¯å…è®¸ä¸ºæ•…éšœæƒ…å†µå®šä¹‰æè¿°æ€§åç§°å’Œæ•°æ®ï¼Œå¯ç”¨äºè¿˜åŸè¯­å¥ã€‚

ä¾‹ï¼Œå®šä¹‰é”™è¯¯ï¼š

```solidity
error Fail(...); // å®šä¹‰é”™è¯¯
```

### æ˜ å°„

ä¾‹ï¼Œå°†åœ°å€æ˜ å°„åˆ°uintï¼š

```solidity
mapping (address => uint) public balance;
```

### ç»“æ„ä½“

ç»“æ„æ˜¯è‡ªå®šä¹‰å®šä¹‰çš„ç±»å‹ï¼Œå¯ä»¥å¯¹å¤šä¸ªå˜é‡è¿›è¡Œåˆ†ç»„ã€‚

ä¾‹ï¼Œå®šä¹‰ç»“æ„ä½“ï¼š

```solidity
struct info { // å®šä¹‰ç»“æ„ä½“
	uint id;
	...
}
```



## é¢å‘å¯¹è±¡

### æƒé™

| æƒé™   | è¯´æ˜ |
| ------ | ---- |
| public |      |
|        |      |
|        |      |

### æ„é€ å‡½æ•°

TODO

### æˆå‘˜å‡½æ•°

TODO



## å‚è€ƒ

[1] [Solidity](https://www.osgeo.cn/solidity/index.html)

[2] [Solidity æ•™ç¨‹](https://www.w3cschool.cn/solidity/)